import"../styles/styles.css";import"../index.html";import{fetchAllData,fetchPlanets}from"./fetchData";import{Pagination}from"./pagination";const table=document.querySelector("tbody"),loader=document.querySelector(".loader"),pagination_elements=document.querySelector(".pagination");function onDOMLoaded(){getResidentsList(1)}document.addEventListener("DOMContentLoaded",onDOMLoaded);const pagination=new Pagination;async function getPlanets(t){try{const e=await fetchPlanets(t);if(pagination.setPagination(t,e.results.length,e.count),e.results.length){const t=(await Promise.all(e.results?.map((t=>Promise.all(t.residents?.map((async(e,n)=>{const a=await fetchAllData(e,t.name,"Residents");return{index:n+1,planet:t.name,residentName:a.name,species:a.species}}))))))).flatMap((t=>t));return(await Promise.all(t.map((async t=>t.species.length?await Promise.all(t.species.map((async e=>{const n=await fetchAllData(e,t.residentName,"Species");return t.species=n.name,t}))):(t.species="Human",t))))).flatMap((t=>t))}}catch(t){console.error(t)}}function generateTable(t,e){t.innerHTML="";for(let n of e){let e=t.insertRow();for(let t in n){let a=e.insertCell(),i=document.createTextNode(n[t]);a.appendChild(i)}}setUpPagination(pagination.total,pagination.count)}const getResidentsList=async t=>(loader.removeAttribute("hidden"),table.style.opacity="0.4",await getPlanets(t).then((t=>{loader.setAttribute("hidden",""),table.style.opacity="1",generateTable(table,t)})));export function paginationButton(t){let e=document.createElement("button");return e.classList.add("pagination__btn"),e.innerText=t,pagination.page===t&&e.classList.add("pagination__btn-active"),e.addEventListener("click",(function(){getResidentsList(t),document.querySelector(".pagination__btn-active").classList.remove("pagination__btn-active"),e.classList.add("pagination__btn-active")})),e}export function setUpPagination(t,e){pagination_elements.innerHTML="";let n=Math.ceil(t/e);for(let t=0;t<n;t++){let e=paginationButton(t+1);pagination_elements.appendChild(e)}}